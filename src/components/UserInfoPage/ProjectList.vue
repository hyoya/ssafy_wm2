<!--GetProjectByUserId-->
<template>
  <div style="">
    <v-layout row wrap justify-center>

      <v-flex
        v-for="i in max_project" xs12 sm4 v-if="layout==1"
        style="padding:10px 5px;">
        <ProjectDetail v-on:popdetail="toStory"
          v-on:UPDATE_Project="toStoryUpdate"
          :projectimage="projects[i-1].data.projectimage"
          :projecttitle="projects[i-1].data.projecttitle"
          :projectdescription="projects[i-1].data.projectdescription"
          :project_id="projects[i-1].project_id"
          :project_writer="projects[i-1].data.session_id"
          >
        </ProjectDetail>
      </v-flex>


      <v-flex v-for="i in max_project" xs12 v-if="layout==2">
        <ProjectDetail0 v-on:popdetail="toStory"
          :projectimage="projects[i-1].data.projectimage"
          :projecttitle="projects[i-1].data.projecttitle"
          :projectdescription="projects[i-1].data.projectdescription"
          :project_id="projects[i-1].project_id"
          :project_writer="projects[i-1].data.session_id"
          :projectrank="projects[i-1].data.projectrank"
          :projectterm="projects[i-1].data.projectterm"
          :projecttech="projects[i-1].data.projecttech"
          :projectcontent="projects[i-1].data.projectcontent"
          >
        </ProjectDetail0>
        <v-divider></v-divider>
      </v-flex>
      <v-flex v-for="i in max_project" xs12 v-if="layout==3">
        <ProjectDetail1 v-on:popdetail="toStory"
          :projectimage="projects[i-1].data.projectimage"
          :projecttitle="projects[i-1].data.projecttitle"
          :projectdescription="projects[i-1].data.projectdescription"
          :project_id="projects[i-1].project_id"
          :project_writer="projects[i-1].data.session_id"
          :projectrank="projects[i-1].data.projectrank"
          :projectterm="projects[i-1].data.projectterm"
          :projecttech="projects[i-1].data.projecttech"
          :projectcontent="projects[i-1].data.projectcontent"
          >
        </ProjectDetail1>
        <v-divider></v-divider>
      </v-flex>
    </v-layout>

    <v-layout>
      <v-btn v-if="more" @click="moreproject(max_project)">더보기</v-btn>
    </v-layout>

  </div>
</template>

<script>
import FirebaseService from "@/services/FirebaseService";
import Project from "../Project/Project";
import ProjectDetail from "../Project/ProjectDetail";
import ProjectDetail0 from "../Project/ProjectDetail0";
import ProjectDetail1 from "../Project/ProjectDetail1";
import ProjectUpdator from "./ProjectUpdator";
export default {
  name: "ProjectList",
  data() {
    return {
      projects: [],
      max_project : 3,
      more : true,
    };
  },
  components: {
    Project,
    ProjectDetail,
    ProjectDetail0,
    ProjectDetail1,
    ProjectUpdator,
  },
  created() {
    this.SELECT_Projects();
    this.user = this.$route.params.id;
    this.login = this.$session.get('session_id')
    if ( this.user == this.login ) {
      this.isMine = true;
    } else {
      this.isMine = false;
    }
  },
  props: {
    layout : {type:String}
  },
  methods: {
    async SELECT_Projects() {
      this.id = this.$route.params.id;
      this.projects = await FirebaseService.SELECT_Projects(this.id);
      console.log(this.projects)
    },
    toStory(pcode) {
      // console.log("여기까지왔다.",pcode)
      this.$emit('toStory',pcode);
    },
    DELETE_project(index, project) {
      if (confirm("알림 : 삭제된 프로젝트는 복구가 불가능합니다. 삭제하시겠습니까?")) {
        console.log(project.project_id)
        this.projects.splice(index, 1);
        FirebaseService.DELETE_project(project.project_id)
      }
    },
    moreproject(max_project) {
      var interval = 2
      if (this.projects.length <= max_project + interval) {
        this.max_project = this.projects.length
        this.more = false
        alert('마지막 프로젝트가 나옵니다.')
      } else {
        this.max_project += interval
      }
    },
    toStoryUpdate(pcode) {
   this.$emit('toStoryUpdate',pcode);
  },

  }
};
</script>
